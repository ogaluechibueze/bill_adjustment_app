generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum Role {
  CCRO
  HCC
  BM
  RH
  RA
  IA
  CIA
  MD
  ADMIN
}

enum Status {
  Pending
  Approved
  Rejected
}

enum Stage {
  CCRO
  HCC
  BM
  RH
  RA
  IA
  CIA
  MD
}

model User {
  id                    Int        @id @default(autoincrement())
  email                 String     @unique
  username              String     @unique
  password              String
  role                  Role
  bussinessUnit         String
  region                String     
  active                Boolean    @default(true)
  createdAt             DateTime   @default(now())
  updatedAt             DateTime   @updatedAt

  customers Customer[] @relation("CreatedBy")
}

model Customer {
  id                      Int       @id @default(autoincrement())
  globalAcctNo            String    @unique
  customerName            String
  region                  String?
  businessUnit            String?
  customerType            String?
  meterNumber             String?
  band                    String?
  feederName              String?
  source                  String?
  ticketNo                String?
  initialDebt             Decimal?  @db.Decimal(12,2)
  adjustmentAmount        Decimal?  @db.Decimal(12,2)
  balanceAfterAdjustment  Decimal?  @db.Decimal(12,2)
  adjustmentStartDate     DateTime?
  adjustmentEndDate       DateTime?
  ccroremarks             String?
  hccremarks              String?
  bmremarks               String?
  rhremarks               String?
  raremarks               String?
  iaremarks               String?
  ciaremarks              String?
  mdremarks               String?
  status                  Status    @default(Pending)
  approvalStage           Stage     @default(HCC)

  // ✅ Must always store the user who created this record
  createdById             Int?
  createdBy               User?      @relation("CreatedBy", fields: [createdById], references: [id])

  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
}

model FeederConsumption {
  id            Int       @id @default(autoincrement())
  feederName    String
  month         Int       // 1 = January, 2 = February ...
  year          Int
  consumption   Float     // Units consumed (kWh or whatever unit you use)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Tariff {
  id        Int      @id @default(autoincrement())
  feederName String
  band      String   // A, B, C, D, E
  month     Int
  year      Int
  rate      Float    // Tariff per unit (₦)
}